<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>face-centered cubic cellular automaton</title>
</head>
<body>

<div id="container"></div>
<script src="../external/three.js"></script>

<!-- The vertex and fragment shaders -->
<script src="caShaders.js"></script>

<!-- The cellular automaton class -->
<script src="caSimulation.js"></script>

<!-- The CA renderer class -->
<script src="caRenderer.js"></script>

<script>
// if ( !Detector.webgl ) Detector.addGetWebGLMessage();

  var container;
  var caRenderer;

  var GRID_BASE_SIZE = 32;
  var cellArrays;

  init();
  animate();

  function init () {
    // Initialize the core CA stuff
    cellArrays = new CellularAutomaton(GRID_BASE_SIZE, 100);
    // initialize the grid randomly with a density of 10%
    cellArrays.initializeRandomly(0.1);
    // The 'rules array' is 13x2, representing the neighbor-count (0..12) and current state.
    // An off cell with four, six or 7 neighbors is turned on
    cellArrays.setRule(0, 4, 1);
    cellArrays.setRule(0, 6, 1);
    cellArrays.setRule(0, 7, 1);
    // An on cell with four, 5 6 or 7 neighbors stays on
    cellArrays.setRule(1, 4, 1);
    cellArrays.setRule(1, 5, 1);
    cellArrays.setRule(1, 6, 1);
    cellArrays.setRule(1, 7, 1);

    // Initialize all the rendering bits and pieces
    caRenderer = new CARenderClass(cellArrays);

    container = document.getElementById( 'container' );
    container.appendChild( caRenderer.getDOMElement() );

    window.addEventListener( 'resize', onWindowResize, false );
    window.addEventListener( 'keypress', onKeyPress, false );
  }

  function onWindowResize (event) {
    caRenderer.onResize(window.innerWidth, window.innerHeight);
  }

  function onKeyPress (event) {
    if (event.charCode == 32) {
      cellArrays.updateGrid();
    }
  }

  function animate () {
    requestAnimationFrame(animate);
    cellArrays.updateGrid();
    render();
  }

  function render () {
    caRenderer.buildSceneFromGrid();
    var time = Date.now() * .001;
    caRenderer.setCameraPosition(4*GRID_BASE_SIZE*Math.cos(time/2.0), 2*GRID_BASE_SIZE, 4*GRID_BASE_SIZE*Math.sin(time/2.0));
    caRenderer.setObjectScale(0.75);

    caRenderer.renderScene();
  }

</script>
</body>
</html>
